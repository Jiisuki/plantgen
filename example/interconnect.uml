@startuml
'scale 0.75

header
model Interconnect
import : bus.h
private var bus : Bus_Id_t
public var status : int
in event ButtonPressed : uint8_t
in event ButtonReleased : uint8_t

endheader

[*] -> Idle
Idle -down-> Ready : ButtonPressed
Idle : No buttons pressed here..

state Ready {
    Ready : entry / ${bus} = Bus_getFreeBus()
    Ready : exit / ${bus} = 0
    state CheckBus <<choice>>
    [*] -> CheckBus
    CheckBus -> Wait : [0 != ${bus}]
    state Wait {
        [*] -> HangOn
    }
    Wait : entry / printf("Wait..");
    Wait : exit / printf("No Waits..");
    CheckBus -down-> Error
    Error : entry / printf("ERROR!");
    Wait -down-> Write : ButtonPressed
    note right of Wait : Waiting for another button press
    Write : entry / Bus_writeConfig(${bus}, ${ButtonPressed})
    Write -> Write : ButtonPressed
    Write -> Wait : ButtonReleased [${ButtonReleased} < 2]
}

Ready -> Idle : ButtonReleased [0 == ${ButtonReleased}]

@enduml
