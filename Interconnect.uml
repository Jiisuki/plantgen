@startuml
scale 0.75

header
model Interconnect

import global : stdint.h
import global : bus.h

private var bus : Bus_Id_t
public var error : Error_t

in event BtnPress : uint8_t
in event BtnRelease : uint8_t
in event AllBtnReleased
in event Error : Error_t
endheader

[*] -> Idle

Idle -down-> Ready : BtnPress

state Ready {
    Ready : entry / bus = getFreeBus()

    [*] -> WaitForInput
    WaitForInput -> Write : BtnPress
    Write : entry / writeConfig(bus, valueof(BtnPress))
    Write -> Write : BtnPress
    Write -> WaitForInput : BtnRelease
}

Ready -> Idle : AllBtnReleased
Ready -down-> Error : Error
Error : entry / error = valueof(Error)
Error -> Idle : ClearError

note left of Error : Use interface to read value of [error].

@enduml
